# ==========================================
# ðŸŽ® GAME SERVICE API SUITE (v2 Economy)
# ==========================================
# Best Dotnet Dev Approved
# Usage: Run requests sequentially to test the full flow.

# âš™ï¸ Configuration
@hostname = localhost
@port = 5525
@host = http://{{hostname}}:{{port}}
@contentType = application/json

# ðŸ‘¤ Test User Credentials
@username = gold_farmer_01
@email = farmer@gameservice.com
@password = GoldPlz!123

# ==========================================
# ðŸ¥ SYSTEM HEALTH
# ==========================================

### Health Check
GET {{host}}/health

###

# ==========================================
# ðŸ” AUTHENTICATION FLOW
# ==========================================

### Register New User (Auto-Creates Profile)
# Expected: 200 OK
POST {{host}}/auth/register
Content-Type: {{contentType}}

{
  "username": "{{username}}",
  "email": "{{email}}",
  "password": "{{password}}"
}

> {%
    if (response.status === 200) {
        client.log("âœ… User Registered: " + response.body.username);
    } else if (response.status === 409) {
        client.log("âš ï¸ User already exists (Expected if running twice)");
    }
%}

###

### 2ï¸âƒ£ Login (Get Tokens)
# Expected: 200 OK
POST {{host}}/auth/login
Content-Type: {{contentType}}

{
  "username": "{{username}}",
  "password": "{{password}}"
}

> {%
    if (response.status === 200) {
        client.global.set("auth_token", response.body.accessToken);
        client.log("âœ… Login Success");
    } else {
        client.log("âŒ Login Failed");
    }
%}

###

# ==========================================
# ðŸ’° ECONOMY & GAMEPLAY
# ==========================================

### 3ï¸âƒ£ Get My Profile (Verify Starter Pack)
# Expected: 200 OK, Coins = 100
GET {{host}}/game/me
Authorization: Bearer {{auth_token}}

> {%
    client.test("Has Starter Pack", function() {
        client.assert(response.status === 200, "Response status is not 200");
        client.assert(response.body.stats.Level === 1, "Expected Level 1");
    });
%}

###

### 4ï¸âƒ£ Earn Coins (Looting)
# Expected: 200 OK, New Balance = 150
POST {{host}}/game/coins/transaction
Authorization: Bearer {{auth_token}}
Content-Type: {{contentType}}

{
  "amount": 50
}

> {%
    client.test("Balance Increased", function() {
        client.assert(response.body.newBalance === 150, "Expected balance 150, got " + response.body.newBalance);
    });
%}

###

### 5ï¸âƒ£ Spend Coins (Buying Item)
# Expected: 200 OK, New Balance = 10
POST {{host}}/game/coins/transaction
Authorization: Bearer {{auth_token}}
Content-Type: {{contentType}}

{
  "amount": -140
}

> {%
    client.test("Balance Decreased", function() {
        client.assert(response.body.newBalance === 10, "Expected balance 10, got " + response.body.newBalance);
    });
%}

###

### 6ï¸âƒ£ Overspending Check (Security)
# Expected: 400 Bad Request (Insufficient funds)
POST {{host}}/game/coins/transaction
Authorization: Bearer {{auth_token}}
Content-Type: {{contentType}}

{
  "amount": -20
}

> {%
    client.test("Prevent Overspending", function() {
        client.assert(response.status === 400, "Should return 400 for insufficient funds");
    });
%}

###

# ==========================================
# ðŸ‘‘ ADMIN / USER MANAGEMENT
# ==========================================

### Get All Users
GET {{host}}/admin/users
Authorization: Bearer {{auth_token}}

###

### Delete User (Clean Up)
DELETE {{host}}/admin/users/1
Authorization: Bearer {{auth_token}}