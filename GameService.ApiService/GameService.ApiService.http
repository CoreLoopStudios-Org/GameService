@hostname = localhost
@port = 5525
@host = http://{{hostname}}:{{port}}
@contentType = application/json


@username = gold_farmer_01
@email = farmer@gameservice.com
@password = GoldPlz!123

### Health Check
GET {{host}}/health

###


### Register New User
# Expected: 200 OK (Body is empty on success)
POST {{host}}/auth/register
Content-Type: {{contentType}}

{
  "email": "{{email}}",
  "password": "{{password}}"
}

> {%
    if (response.status === 200) {
        client.log("✅ User Registered Successfully");
    } else if (response.status === 400) {
        client.log("⚠️ Validation Error (or user exists): " + JSON.stringify(response.body));
    }
%}

###

### 2️⃣ Login (Get Tokens)
# Fix: Use "email" key, not "username"
POST {{host}}/auth/login
Content-Type: {{contentType}}

{
  "email": "{{email}}",
  "password": "{{password}}"
}

> {%
    if (response.status === 200) {
        client.global.set("auth_token", response.body.accessToken);
        client.log("✅ Login Success");
    } else {
        client.log("❌ Login Failed: " + response.status);
    }
%}

###


### 3️⃣ Get My Profile (Lazy Creates Profile if missing)
GET {{host}}/game/me
Authorization: Bearer {{auth_token}}

> {%
    client.test("Client Ok", function() {
        client.assert(response.status === 200, "Response status is not 200");
        client.assert(response.body.coins === 100, "Expected default coins 100");
    });
%}

###

### 4️⃣ Earn Coins
POST {{host}}/game/coins/transaction
Authorization: Bearer {{auth_token}}
Content-Type: {{contentType}}

{
  "amount": 50
}

> {%
    client.test("Balance Increased", function() {
        client.assert(response.body.newBalance === 150, "Expected balance 150");
    });
%}