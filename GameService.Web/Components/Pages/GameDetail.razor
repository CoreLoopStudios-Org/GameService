@page "/games/{RoomId}"
@attribute [Authorize]
@rendermode InteractiveServer
@inject GameAdminService AdminService
@inject NavigationManager Nav
@using System.Text.Json

<PageTitle>Game Inspector: @RoomId</PageTitle>

<div class="mb-3">
    <a href="games" class="btn btn-outline-secondary">&larr; Back to Games</a>
</div>

@if (gameState == null)
{
    if (notFound)
    {
        <div class="alert alert-danger">Game not found.</div>
    }
    else
    {
        <div class="spinner-border text-primary" role="status"></div>
    }
}
else
{
    <div class="card">
        <div class="card-header">
            Game State (Raw)
        </div>
        <div class="card-body">
            <pre>@JsonSerializer.Serialize(gameState, new JsonSerializerOptions { WriteIndented = true })</pre>
        </div>
    </div>
}

@code {
    [Parameter] public string RoomId { get; set; } = "";
    
    private JsonElement? gameState;
    private bool notFound = false;

    protected override async Task OnInitializedAsync()
    {
        await LoadGame();
    }

    private async Task LoadGame()
    {
        gameState = await AdminService.GetGameStateAsync(RoomId);
        
        if (gameState == null) notFound = true;
        else notFound = false;
    }
}